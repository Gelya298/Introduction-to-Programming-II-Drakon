<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0049)http://drakon-editor.sourceforge.net/tcl/tcl.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Tcl programming with DRAKON Editor</title></head><body>â€‹
<link rel="stylesheet" href="http://drakon-editor.sourceforge.net/tcl/pygments_style.css">
<style>
	
	body { 
		margin-top:0;
		background-color:#ccccdd;
		margin: 0;
 	 	padding: 0;
 	 	font-family: Verdana, "Bitstream Vera Sans", sans-serif;
 	}
 	pre {
 		margin:5px;
 	}
 	
	.top_menu { margin:0; padding:3px; }
	h2 { border-style:solid; 
		border-top-width:7px;
		border-bottom-width:0;
		border-left-width:0;
		border-right-width:0;
		border-color:#ccccdd; 
		background:#efefff;
		padding:5px;
	}
	p { 
		padding:5px; 
		font-size:100%;	
	}
	h1 { 
		padding:5px; 
		background:#efefff;
		margin:0;
	}
	
	.container {
		background-color:#ffffff;
		width:850px;
		position:center;
		border-style:solid;
		border-color:#000030;
		border-width:0px; 
		padding:0;
		margin:0 auto;
	}
	
	table.reference
	{
	background-color:#ffffff;
	border:1px solid #c3c3c3;
	border-collapse:collapse;
	width:97%;
	margin-left:10px;
	}
	
	table.reference th
	{
	background-color:#e5eecc;
	border:1px solid #c3c3c3;
	padding:3px;
	vertical-align:top;
	}
	
	table.reference td 
	{
	border:1px solid #c3c3c3;
	padding:3px;
	vertical-align:top;
	}
	pre {
		border-style:dashed;
		border-width:1px;
		border-color:#000000;
		padding:5px;
	}
</style>


<div id="header" class="container">


<h1>Tcl programming with DRAKON Editor</h1>

<p class="top_menu"><a href="http://drakon-editor.sourceforge.net/">Home </a>|
<a href="https://sourceforge.net/projects/drakon-editor/files/">Download</a></p>

<p>This is a short tutorial of using Tcl together with DRAKON for building real programs.
A more advanced tutorial can be found in <strong>examples/Tcl</strong> folder in
<a href="http://sourceforge.net/projects/drakon-editor/files/drakon_editor1.8.zip/download">drakon_editor1.8.zip</a>.</p>

<p>In the <strong>generators</strong> folder you can find a few real-life DRAKON-Tcl modules.</p>

<h2>Contents</h2>

<ul>
<li>The basics
<ul>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#hello">Hello, world</a></li>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#parameters">Formal parameters</a></li>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#own_code">Adding your own code to the generated source file</a></li>
</ul></li>
<li>Flow control
<ul>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#if">Flow control with If</a></li>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#select">Control flow with Select</a></li>
</ul></li>
<li>Loops
<ul>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#arrow">Loops with Arrow</a></li>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#foreach">Foreach loop</a></li>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#cloop">C-style loop</a></li>
</ul></li>
<li><a href="http://drakon-editor.sourceforge.net/tcl/tcl.html#comments">Commenting out diagrams</a></li>
</ul>

<p><a name="hello"></a></p><a name="hello">

<h2>Hello, world</h2>

<ol>
<li><p>Create a new file with DRAKON Editor.</p></li>
<li><p>Select Tcl as the programming language. In the main menu, go to <strong>File / File properties...</strong>
and choose "Tcl".</p></li>
<li><p>Create a new diagram called <code>Hello</code>:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/Hello.png" alt="Hello world in DRAKON-Tcl" title=""></p></li>
<li><p>Add your own code. In the main menu, go to <strong>File / File description...</strong> and add the following text:</p>

<p><b>=== footer ===<br>
Hello</b></p></li>
<li><p>Generate the source code. In the main menu, go to <strong>DRAKON / Generate code</strong> or just press Ctrl-B (Command-B on Mac).</p></li>
</ol>

<p>DRAKON Editor will create a new .tcl file and put it next to the .drn file. The Tcl code will be something like this:</p>

<pre><span class="k">proc</span> Hello <span class="k">{</span> <span class="k">}</span> <span class="k">{</span>
        <span class="c">#item 16</span>
    <span class="nb">puts</span> <span class="s2">"Hello, world!"</span>
    <span class="k">return</span> <span class="k">{}</span>
<span class="k">}</span>

<span class="nv">Hello</span>
</pre>

</a><p><a name="parameters"></a></p><a name="parameters">

<h2>Formal parameters</h2>

<p>The formal parameters of the procedure are placed in the special <em>Parameters</em> icon, to the right from the <em>Begin</em> icon.</p>

<p>How to create a <em>Parameters</em> icon:</p>

<ol>
<li><p>Add a new <em>Action</em> icon and put it next to the right side of the <em>Begin</em> icon.</p></li>
<li><p>Connect the <em>Begin</em> icon with the new <em>Action</em> icon with a horizontal line.</p></li>
<li><p>Add parameters, one parameter per line.</p>

<p><img src="./Tcl programming with DRAKON Editor_files/Parameters.png" alt="Formal parameters" title=""></p></li>
</ol>

<p>DRAKON Editor will generate the following code for the diagram:</p>

<pre><span class="k">proc</span> DoubleHello <span class="k">{</span> firstGreeting secondGreeting <span class="k">}</span> <span class="k">{</span>
        <span class="c">#item 22</span>
    <span class="nb">puts</span> <span class="nv">$firstGreeting</span>
    <span class="c">#item 23</span>
    <span class="nb">puts</span> <span class="nv">$secondGreeting</span>
    <span class="k">return</span> <span class="k">{}</span>
<span class="k">}</span>
</pre>

<p>Note the <em>item</em> comments in the generated code. They tell which icon on the diagram the next piece of code is generated from.</p>

<p>To jump to the specific icon if you know its number, press Ctrl-I and enter the number. This is really convenient for debugging.</p>

</a><p><a name="own_code"></a></p><a name="own_code">

<h2>Adding your own code to the generated source file</h2>

<p>Sometimes it is necessary to add some hand-written code 
to the generated file. DRAKON Editor allows you to do that
using the so called <em>sections</em> in the file description.</p>

<p>To edit the file description, go to <strong>File / File description...</strong></p>

<p>The <em>header</em> section is added at the beginning of the generated file:</p>

<pre>=== header ===
puts "this code is put at the top"
puts "there can be several lines"
</pre>

<p>The <em>footer</em> section is added at the end of the generated file:</p>

<pre>=== footer ===
puts "this code is put at the bottom"
puts "this is the last line"
</pre>

<p>We were using the <em>footer</em> section in the <strong>Hello</strong> example above
to actually run the procedure we created.</p>

<p>The section content is all text below the section header until
the next section of end of file.</p>

<p>The text in the file description that goes before any sections
is ignored.</p>

</a><p><a name="if"></a></p><a name="if">

<h2>Flow control with If</h2>

<p>The <em>If</em> icon produces the <em>if</em> statement:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/LimitedPrint.png" alt="If example" title=""></p>

<p>The <em>If</em> icon in the diagram above produces this code:</p>

<pre><span class="c">#item 30</span>
<span class="k">if</span> <span class="k">{</span><span class="nv">$length</span> <span class="o">&lt;=</span> <span class="nv">$maxLength</span><span class="k">}</span> <span class="k">{</span>
    <span class="c">#item 31</span>
    <span class="nb">puts</span> <span class="s2">"The text is short enough."</span>
    <span class="nb">puts</span> <span class="s2">"I can print it:"</span>
    <span class="nb">puts</span> <span class="nv">$text</span>
    <span class="k">return</span> <span class="k">{}</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="c">#item 34</span>
    <span class="nb">puts</span> <span class="s2">"The text is too long."</span>
    <span class="k">return</span> <span class="k">{}</span>
<span class="k">}</span>
</pre>

<p>It is possible to swap <em>YES</em> and <em>NO</em> exits of an <em>if</em> icon. 
Right-click on the <em>if</em> icon and choose <strong>Swap YES and NO</strong>.</p>

<p><img src="./Tcl programming with DRAKON Editor_files/swap.png" alt="Swap YES and NO" title=""></p>

</a><p><a name="select"></a></p><a name="select">

<h2>Control flow with Select</h2>

<p>Imagine you need to make a choice out of several options based
on some value. In Tcl, you would write something like this:</p>

<pre><span class="k">if</span> <span class="k">{</span><span class="nv">$number</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> <span class="s2">"zero"</span>
<span class="k">}</span> <span class="k">elseif</span> <span class="k">{</span><span class="nv">$number</span> <span class="o">==</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> <span class="s2">"one"</span>
<span class="k">}</span> <span class="k">elseif</span> <span class="k">{</span><span class="nv">$number</span> <span class="o">==</span> <span class="nv">2</span><span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> <span class="s2">"two"</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="nb">puts</span> <span class="s2">"a lot"</span>
<span class="k">}</span>

</pre>

<p>In DRAKON, you can use the <em>Select</em> and <em>Case</em> icons like this:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/select.png" alt="Select" title=""></p>

</a><p><a name="arrow"></a></p><a name="arrow">

<h2>Loops with Arrow</h2>

<p>When an <em>Arrow</em> is added to an <em>If</em> or <em>Select</em>, a loop is created.</p>

<ol>
<li><p>Do-Check loop:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/arrow1.png" alt="Do-check loop" title=""></p></li>
<li><p>Check-Do loop:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/arrow2.png" alt="Check-Do loop" title=""></p></li>
<li><p>Do-Check-Do (hybrid) loop:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/arrow3.png" alt="Do-Check-Do loop" title=""></p></li>
</ol>

</a><p><a name="foreach"></a></p><a name="foreach">

<h2>Foreach loop</h2>

<pre>
<span class="k">proc</span> PrintStrings <span class="k">{</span> <span class="nv">strings</span> <span class="k">}</span> <span class="k">{</span>
    <span class="k">foreach</span> item <span class="nv">$strings</span> <span class="k">{</span>
        <span class="nb">puts</span> <span class="nv">$item</span>
    <span class="k">}</span>
<span class="k">}</span>

</pre>

<p>The DRAKON equivalent for the Tcl code above is:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/foreach.png" alt="foreach" title=""></p>

<p>Note that the keyword <em>foreach</em> and the loop variable are followed by a semicolon (;) which is unusual for Tcl.</p>

</a><p><a name="cloop"></a></p><a name="cloop">

<h2>C-style loop</h2>

<p>With DRAKON, it is possible to write C-style <em>for</em> constructs:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/for.png" alt="for" title=""></p>

<p>Which is a syntactically sugared version of the below
picture:</p>

<p><img src="./Tcl programming with DRAKON Editor_files/for2.png" alt="for" title=""></p>

</a><p><a name="comments"></a></p><a name="comments">

<h2>Commenting out diagrams</h2>

<p>It is possible to exclude the whole diagram from code generation.</p>

<p>If the first line of the formal parameters list is<br>
<code>#comment</code><br>
then no code is generated for this diagram.</p>

<p>Its correctness, however, will still be checked against the DRAKON rules.</p>

<p><img src="./Tcl programming with DRAKON Editor_files/comment.png" alt="comment" title=""></p>
</a></div><a name="comments">



</a></body></html>